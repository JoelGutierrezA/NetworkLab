<!-- HEADER del dashboard -->
<app-header-dashboard></app-header-dashboard>

<!-- Barra superior de acciones (sobre los filtros) -->
<div class="top-actions" *ngIf="isLabManager">
  <button class="btn-primary add-service-btn" (click)="toggleAddForm()">
    {{ showAddForm ? 'Cancelar' : 'Agregar servicio' }}
  </button>
</div>

<div class="services-wrapper">
  <!-- Sidebar de filtros -->
  <aside class="filters">
    <h3>üîç Filtros</h3>
    <input type="text" placeholder="Buscar servicio..." [(ngModel)]="searchTerm" class="filter-input" />

  <label for="cat-filter">Categor√≠a</label>
  <select id="cat-filter" [(ngModel)]="selectedCategory">
      <option value="">Todas</option>
      <option value="laboratorio">Laboratorio</option>
      <option value="cl√≠nico">Cl√≠nico</option>
      <option value="alimentos">Alimentos</option>
    </select>

  <label for="prov-filter">Proveedor</label>
  <select id="prov-filter" [(ngModel)]="selectedProvider">
      <option value="">Todos</option>
      <option *ngFor="let provider of providers">{{ provider }}</option>
    </select>

    <button class="btn-primary" (click)="applyFilters()">Aplicar</button>
  </aside>

  <!-- Columna central: servicios -->
  <main class="services-list">
    <div class="service-card" *ngFor="let service of filteredServices">
      <h4>{{ service.name }}</h4>
      <p>{{ service.description }}</p>
      <span class="provider">Ofrecido por: {{ service.provider }}</span>
      <button class="btn-secondary">Ver m√°s</button>
    </div>
  </main>
</div>

<!-- Modal/Overlay para agregar servicio -->
<div class="modal-backdrop" *ngIf="showAddForm" (click)="toggleAddForm()" (keydown.escape)="toggleAddForm()">
  <dialog class="modal" open (click)="$event.stopPropagation()" (keydown.escape)="toggleAddForm()">
    <div class="modal-header">
      <h3>Agregar nuevo servicio</h3>
      <button class="icon-btn" (click)="toggleAddForm()" aria-label="Cerrar">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="field">
          <label for="svc-name">Nombre</label>
          <input id="svc-name" [(ngModel)]="newService.name" />
        </div>

        <div class="field">
          <label for="svc-model">Modelo</label>
          <input id="svc-model" [(ngModel)]="newService.model" />
        </div>

        <div class="field field-span-2">
          <label for="svc-desc">Descripci√≥n</label>
          <textarea id="svc-desc" [(ngModel)]="newService.description"></textarea>
        </div>

        <div class="field">
          <label for="svc-manufacturer">Fabricante</label>
          <input id="svc-manufacturer" [(ngModel)]="newService.manufacturer" />
        </div>

        <div class="field">
          <fieldset class="seg-fieldset">
            <legend class="seg-legend">¬øRequiere entrenamiento?</legend>
            <div class="segmented" role="radiogroup">
              <label class="seg-pill">
                <input type="radio" name="reqTraining" [value]="true" [(ngModel)]="newService.requires_training" />
                <span>S√≠</span>
              </label>
              <label class="seg-pill">
                <input type="radio" name="reqTraining" [value]="false" [(ngModel)]="newService.requires_training" />
                <span>No</span>
              </label>
            </div>
          </fieldset>
        </div>

        <div class="field">
          <label for="svc-status">Estado</label>
          <select id="svc-status" [(ngModel)]="newService.status">
            <option value="available">Disponible</option>
            <option value="in_use">En uso</option>
            <option value="maintenance">Mantenimiento</option>
            <option value="out_of_service">Fuera de servicio</option>
          </select>
        </div>

        <div class="field field-span-2">
          <label for="lab-search">Laboratorio</label>
          <div class="lab-dropdown">
            <div class="lab-input-row">
              <input id="lab-search" type="text" [(ngModel)]="labSearchTerm" name="labSearchTerm" placeholder="Buscar laboratorio..." (focus)="showLabList=true" (input)="showLabList=true" autocomplete="off" />
              <button type="button" class="btn-secondary" (click)="showLabList=!showLabList">Ver todos</button>
            </div>
            <ul *ngIf="showLabList" class="lab-list">
              <li *ngFor="let lab of filteredLaboratories" [class.active]="lab.id===newService.laboratory_id">
                <button type="button" class="lab-item" (click)="selectLab(lab)">{{ lab.name }}</button>
              </li>
              <li *ngIf="filteredLaboratories.length===0" class="empty">No hay laboratorios</li>
            </ul>
          </div>
          <input type="hidden" [(ngModel)]="newService.laboratory_id" name="laboratory_id" />
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="toggleAddForm()">Cancelar</button>
      <button class="btn-primary" (click)="submitNewService()">Crear servicio</button>
    </div>
  </dialog>
  </div>

<!-- FOOTER -->
<app-footer></app-footer>
