<!-- HEADER del dashboard -->
<app-header-dashboard></app-header-dashboard>

<div class="profile-wrapper">
  <!-- HERO -->
  <section class="profile-hero">
    <div class="profile-identity">
      <div class="avatar">
        <span>{{ (firstName || 'A')[0] }}{{ (lastName || 'N')[0] }}</span>
      </div>
      <div class="identity-texts">
        <h1 class="display-name">{{ firstName }} {{ lastName }}</h1>
        <div class="email">{{ email }}</div>
        <span class="role-pill">{{ role }}</span>
      </div>
    </div>

    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-number">3</div>
        <div class="stat-label">Proyectos</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">8</div>
        <div class="stat-label">Colaboraciones</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">126</div>
        <div class="stat-label">Días activo</div>
      </div>
    </div>
  </section>

  <!-- TABS -->
  <div class="tabs-row">
    <button class="tab" [class.active]="activeTab === 'info'" (click)="setTab('info')">
      Información
    </button>
    <button class="tab" [class.active]="activeTab === 'security'" (click)="setTab('security')">
      Seguridad
    </button>
    <button class="tab" [class.active]="activeTab === 'activity'" (click)="setTab('activity')">
      Actividad
    </button>
    <button class="tab" [class.active]="activeTab === 'notifications'" (click)="setTab('notifications')">
      Notificaciones
    </button>
  </div>

  <!-- =================== TAB: INFORMACIÓN =================== -->
  <div class="profile-section-card" *ngIf="activeTab === 'info'">
    <div class="section-header">
      <h3 class="section-title">Información del perfil</h3>

      <button class="btn-edit" type="button" (click)="toggleEdit()">
        {{ isEditing ? 'Dejar de editar' : 'Editar perfil' }}
      </button>
    </div>

    <form (ngSubmit)="saveProfile()">
      <div class="grid-2">
        <div class="form-field">
          <label>Nombre</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="firstName"
            name="firstName"
            [disabled]="!isEditing"
          />
        </div>

        <div class="form-field">
          <label>Apellido</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="lastName"
            name="lastName"
            [disabled]="!isEditing"
          />
        </div>

        <div class="form-field">
          <label>Correo</label>
          <input
            type="email"
            class="form-control"
            [(ngModel)]="email"
            name="email"
            [disabled]="!isEditing"
          />
        </div>

        <div class="form-field">
          <label>Teléfono</label>
          <input
            type="tel"
            class="form-control"
            [(ngModel)]="phone"
            name="phone"
            [disabled]="!isEditing"
          />
        </div>

        <div class="form-field">
          <label>Institución</label>
          <select
            class="form-control"
            [(ngModel)]="selectedInstitution"
            name="institution"
            [disabled]="!isEditing"
          >
            <option *ngFor="let inst of institutions" [value]="inst.id">
              {{ inst.name }}
            </option>
          </select>
        </div>


        <div class="form-field form-field--full">
          <label>Biografía</label>
          <textarea
            class="form-control"
            rows="5"
            [(ngModel)]="bio"
            name="bio"
            placeholder="Cuéntanos sobre tus líneas de investigación…"
            [disabled]="!isEditing"
          ></textarea>
        </div>
      </div>

      <div class="form-actions" *ngIf="isEditing">
        <button type="button" class="btn-secondary" (click)="cancelEdit()">
          Cancelar
        </button>
        <button type="submit" class="btn-primary">
          Guardar cambios
        </button>
      </div>
    </form>
  </div>

  <!-- =================== TAB: SEGURIDAD =================== -->
  <div class="profile-section-card" *ngIf="activeTab === 'security'">
    <div class="section-header">
      <h3 class="section-title">Seguridad</h3>
    </div>

    <form (ngSubmit)="changePassword()">
      <div class="grid-2">
        <div class="form-field form-field--full">
          <label>Contraseña actual</label>
          <input
            type="password"
            class="form-control"
            [(ngModel)]="oldPassword"
            name="oldPassword"
            autocomplete="current-password"
          />
        </div>

        <div class="form-field">
          <label>Nueva contraseña</label>
          <input
            type="password"
            class="form-control"
            [(ngModel)]="newPassword"
            name="newPassword"
            autocomplete="new-password"
          />
        </div>

        <div class="form-field">
          <label>Confirmar nueva contraseña</label>
          <input
            type="password"
            class="form-control"
            [(ngModel)]="confirmPassword"
            name="confirmPassword"
            autocomplete="new-password"
          />
        </div>
      </div>

      <div class="feedback" *ngIf="successMsg || errorMsg">
        <div class="alert success" *ngIf="successMsg">{{ successMsg }}</div>
        <div class="alert error" *ngIf="errorMsg">{{ errorMsg }}</div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary" [disabled]="isSubmitting">
          {{ isSubmitting ? 'Guardando…' : 'Actualizar contraseña' }}
        </button>
      </div>
    </form>
  </div>

  <!-- =================== PLACEHOLDERS (si se usan luego) =================== -->
  <div class="profile-section-card" *ngIf="activeTab === 'activity'">
    <div class="section-header">
      <h3 class="section-title">Actividad</h3>
    </div>
    <p class="placeholder">Aquí podrás ver y filtrar la actividad reciente de tu cuenta.</p>
  </div>

  <div class="profile-section-card" *ngIf="activeTab === 'notifications'">
    <div class="section-header">
      <h3 class="section-title">Notificaciones</h3>
    </div>
    <p class="placeholder">Configura tus preferencias de notificación aquí.</p>
  </div>
</div>

<!-- FOOTER -->
<app-footer></app-footer>
